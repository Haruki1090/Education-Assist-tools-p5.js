<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>原子と電子の関係性の可視化</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #0d47a1, #42a5f5);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .visualization-container {
            flex: 1;
            min-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .canvas-container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
            height: 450px;
        }
        
        .info-container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        
        .element-info {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .element-symbol {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            color: white;
            border-radius: 8px;
        }
        
        .element-details {
            flex: 1;
        }
        
        .element-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .element-properties {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }
        
        .electron-config {
            background-color: #f1f8fe;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .config-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #0d47a1;
        }
        
        .config-notation {
            font-family: monospace;
            font-size: 16px;
        }
        
        .electron-shells {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .shell {
            background-color: #e1f5fe;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
        }
        
        .element-facts {
            background-color: #fff8e1;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }
        
        .facts-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #ff6f00;
        }
        
        .facts-content {
            font-size: 14px;
            line-height: 1.6;
        }
        
        .periodic-table-container {
            flex: 1;
            min-width: 300px;
        }
        
        .periodic-table {
            display: grid;
            grid-template-columns: repeat(18, 1fr);
            gap: 3px;
            margin-bottom: 20px;
        }
        
        .element {
            aspect-ratio: 1;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            transition: transform 0.3s, box-shadow 0.3s;
            background-color: #fff;
            position: relative;
        }
        
        .element:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 2;
        }
        
        .element.active {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 3;
        }
        
        .element-atomic-number {
            position: absolute;
            top: 2px;
            left: 4px;
            font-size: 10px;
            color: #666;
        }
        
        .element-symbol {
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }
        
        .element-mass {
            font-size: 8px;
            color: #666;
            position: absolute;
            bottom: 2px;
            right: 3px;
        }
        
        .element-name-small {
            font-size: 7px;
            color: #666;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 100%;
            padding: 0 2px;
        }
        
        /* Element coloring by category */
        .alkali-metal {
            background-color: #ffcdd2;
        }
        
        .alkaline-earth-metal {
            background-color: #f8bbd0;
        }
        
        .transition-metal {
            background-color: #e1bee7;
        }
        
        .post-transition-metal {
            background-color: #c5cae9;
        }
        
        .metalloid {
            background-color: #b3e5fc;
        }
        
        .nonmetal {
            background-color: #b2dfdb;
        }
        
        .halogen {
            background-color: #c8e6c9;
        }
        
        .noble-gas {
            background-color: #dcedc8;
        }
        
        .lanthanide {
            background-color: #fff9c4;
        }
        
        .actinide {
            background-color: #ffe0b2;
        }
        
        .element-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .category {
            display: flex;
            align-items: center;
            font-size: 12px;
            margin-right: 10px;
        }
        
        .category-color {
            width: 12px;
            height: 12px;
            margin-right: 5px;
            border-radius: 2px;
        }
        
        .electron-animation-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .control-button {
            padding: 8px 15px;
            background-color: #2196f3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .control-button:hover {
            background-color: #1976d2;
        }
        
        .control-button svg {
            width: 16px;
            height: 16px;
        }
        
        .control-button.slow {
            background-color: #4caf50;
        }
        
        .control-button.slow:hover {
            background-color: #388e3c;
        }
        
        .control-button.fast {
            background-color: #ff9800;
        }
        
        .control-button.fast:hover {
            background-color: #f57c00;
        }
        
        .view-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .view-toggle {
            padding: 8px 15px;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .view-toggle:hover {
            background-color: #e9e9e9;
        }
        
        .view-toggle.active {
            background-color: #bbdefb;
            border-color: #64b5f6;
        }
        
        /* Modal/Popup styling */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .modal-title {
            margin-bottom: 15px;
            color: #0d47a1;
            font-size: 22px;
        }
        
        .modal-section {
            margin-bottom: 20px;
        }
        
        .modal-subtitle {
            font-size: 18px;
            margin-bottom: 10px;
            color: #0d47a1;
        }
        
        .model-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .model-toggle {
            padding: 8px 15px;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .model-toggle:hover {
            background-color: #e9e9e9;
        }
        
        .model-toggle.active {
            background-color: #bbdefb;
            border-color: #64b5f6;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .periodic-table {
                grid-template-columns: repeat(9, 1fr);
            }
            
            .element {
                font-size: 10px;
            }
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 100;
            pointer-events: none;
            max-width: 200px;
            display: none;
        }
        
        .subshell-info {
            margin-top: 15px;
            padding: 12px;
            background-color: #e8f5e9;
            border-radius: 8px;
        }
        
        .color-scale {
            display: flex;
            flex-direction: column;
            margin-bottom: 20px;
        }
        
        .color-scale-title {
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .color-bars {
            display: flex;
            height: 20px;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .color-bar {
            flex: 1;
            height: 100%;
        }
        
        .color-labels {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #666;
            margin-top: 3px;
        }
        
        .disabled-element {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .empty-cell {
            background-color: transparent;
            border: none;
            cursor: default;
        }
        
        .element-separator {
            grid-column: span 10;
            height: 10px;
        }
        
        .lanthanide-actinide-container {
            display: grid;
            grid-template-columns: repeat(15, 1fr);
            gap: 3px;
            margin-top: 10px;
            padding-left: 10%;
        }
        
        /* Custom Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            z-index: 10;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-right: 15px;
            font-size: 12px;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            margin-right: 5px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>原子と電子の関係性の可視化</h1>
            <p>原子構造と電子配置を探索して理解を深めましょう</p>
        </header>
        
        <div class="main-content">
            <div class="visualization-container">
                <div class="electron-animation-controls">
                    <button class="control-button slow" id="slower-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 13c0 2.08-.8 3.97-2.1 5.39V11H14v7.39c-1.3-1.42-2.1-3.31-2.1-5.39 0-2.08.8-3.97 2.1-5.39V11h2.9v2zm-9-.05V5H8v7.95c-1.3-1.42-2.1-3.31-2.1-5.39 0-2.08.8-3.97 2.1-5.39V5h2v7.95z"/>
                        </svg>
                        速度を遅く
                    </button>
                    <button class="control-button" id="pause-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                        </svg>
                        一時停止
                    </button>
                    <button class="control-button fast" id="faster-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M10 8.64v6.72L15.27 12 10 8.64m-8-3.56v14l11.09-7.02L2 5.08z"/>
                        </svg>
                        速度を速く
                    </button>
                </div>
                
                <div class="view-controls">
                    <button class="view-toggle active" id="bohr-model">ボーアモデル</button>
                    <button class="view-toggle" id="orbital-model">軌道モデル</button>
                    <button class="view-toggle" id="electron-cloud">電子雲モデル</button>
                    <button class="view-toggle" id="show-labels">ラベル表示</button>
                </div>
                
                <div class="canvas-container" id="canvas-container"></div>
                
                <div class="info-container">
                    <div class="element-info">
                        <div class="element-symbol" id="element-symbol-box">H</div>
                        <div class="element-details">
                            <div class="element-name" id="element-name">水素（Hydrogen）</div>
                            <div class="element-properties" id="element-properties">
                                原子番号: 1 | 原子量: 1.008 | 電子数: 1 | 陽子数: 1 | 中性子数: 0
                            </div>
                        </div>
                    </div>
                    
                    <div class="electron-config">
                        <div class="config-title">電子配置</div>
                        <div class="config-notation" id="electron-config-notation">1s¹</div>
                        <div class="electron-shells" id="electron-shells">
                            <div class="shell">K殻: 1</div>
                        </div>
                    </div>
                    
                    <div class="element-facts">
                        <div class="facts-title">豆知識</div>
                        <div class="facts-content" id="element-facts">
                            水素は宇宙で最も豊富な元素であり、全ての恒星のエネルギー源として機能しています。また、水素は水の主要成分でもあります。
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="periodic-table-container">
                <div class="element-categories">
                    <div class="category">
                        <div class="category-color" style="background-color: #ffcdd2;"></div>
                        <span>アルカリ金属</span>
                    </div>
                    <div class="category">
                        <div class="category-color" style="background-color: #f8bbd0;"></div>
                        <span>アルカリ土類金属</span>
                    </div>
                    <div class="category">
                        <div class="category-color" style="background-color: #e1bee7;"></div>
                        <span>遷移金属</span>
                    </div>
                    <div class="category">
                        <div class="category-color" style="background-color: #c5cae9;"></div>
                        <span>その他の金属</span>
                    </div>
                    <div class="category">
                        <div class="category-color" style="background-color: #b3e5fc;"></div>
                        <span>半金属</span>
                    </div>
                    <div class="category">
                        <div class="category-color" style="background-color: #b2dfdb;"></div>
                        <span>非金属</span>
                    </div>
                    <div class="category">
                        <div class="category-color" style="background-color: #c8e6c9;"></div>
                        <span>ハロゲン</span>
                    </div>
                    <div class="category">
                        <div class="category-color" style="background-color: #dcedc8;"></div>
                        <span>希ガス</span>
                    </div>
                    <div class="category">
                        <div class="category-color" style="background-color: #fff9c4;"></div>
                        <span>ランタノイド</span>
                    </div>
                    <div class="category">
                        <div class="category-color" style="background-color: #ffe0b2;"></div>
                        <span>アクチノイド</span>
                    </div>
                </div>
                
                <div class="periodic-table" id="periodic-table">
                    <!-- JavaScript で周期表を生成 -->
                </div>
                
                <div class="lanthanide-actinide-container" id="lanthanide-actinide-container">
                    <!-- JavaScript でランタノイドとアクチノイドを生成 -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- 詳細情報モーダル -->
    <div class="modal" id="detail-modal">
        <div class="modal-content">
            <span class="modal-close" id="modal-close">&times;</span>
            <h2 class="modal-title" id="modal-title">水素 (H)</h2>
            
            <div class="modal-section">
                <h3 class="modal-subtitle">電子配置の説明</h3>
                <p id="electron-explanation">
                    水素は最も単純な原子構造を持ち、1つの電子が1s軌道に存在します。これはK殻とも呼ばれる最初の電子殻に相当します。
                </p>
                
                <div class="model-selector">
                    <button class="model-toggle active" data-model="bohr">ボーアモデル</button>
                    <button class="model-toggle" data-model="quantum">量子力学モデル</button>
                </div>
                
                <div id="bohr-explanation">
                    <p>ボーアモデルでは、電子は原子核の周りを特定の軌道（殻）で周回していると考えます。各軌道にはエネルギーレベルがあり、電子はエネルギーを吸収または放出することで軌道間を移動できます。</p>
                    <p>水素の場合、1つの電子がK殻と呼ばれる最初の軌道に存在します。この電子が別の軌道に移動するには特定のエネルギーが必要で、これが水素原子の特徴的なスペクトル線を生み出します。</p>
                </div>
                
                <div id="quantum-explanation" style="display: none;">
                    <p>量子力学モデルでは、電子は特定の位置を持たず、原子核の周りの「確率雲」として存在します。この確率分布は軌道（オービタル）と呼ばれ、電子が見つかる可能性が高い領域を表します。</p>
                    <p>水素の電子は1s軌道に存在し、この軌道は球形の確率分布を持ちます。量子数n=1, l=0, m=0, s=±1/2で表されるこの状態は、原子核に最も近い位置に電子が存在する確率が最も高いことを示しています。</p>
                </div>
            </div>
            
            <div class="modal-section">
                <h3 class="modal-subtitle">重要な特性と用途</h3>
                <p id="element-importance">
                    水素は宇宙で最も豊富な元素であり、全ての恒星のエネルギー源です。地球上では主に水（H₂O）の形で存在し、生命活動に不可欠です。工業的には化学合成、燃料、還元剤として幅広く使用されています。また、将来のクリーンエネルギー源としても期待されています。
                </p>
            </div>
            
            <div class="modal-section">
                <h3 class="modal-subtitle">発見の歴史</h3>
                <p id="element-history">
                    水素は1766年にヘンリー・キャヴェンディッシュによって単体元素として識別されました。彼は金属と酸の反応で生じるガスを研究し、このガスが燃焼すると水が生成されることを発見しました。この性質から「水を生み出すもの」という意味で「ヒドロゲン（水素）」と名付けられました。
                </p>
            </div>
            
            <div class="modal-section" id="subshell-info-container">
                <h3 class="modal-subtitle">サブシェルと軌道の情報</h3>
                <div class="subshell-info">
                    <p>水素原子では、電子は最も低いエネルギー状態である1sサブシェルに存在します。</p>
                    <p>- s軌道：球形の確率分布を持ち、電子2個まで収容可能</p>
                    <p>- p軌道：ダンベル型の確率分布で、x, y, z方向に3つ存在し、合計6個の電子を収容可能</p>
                    <p>- d軌道：より複雑な形状で5つ存在し、合計10個の電子を収容可能</p>
                    <p>- f軌道：さらに複雑な形状で7つ存在し、合計14個の電子を収容可能</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>
    
    <script>
        // 元素データ（原子番号、記号、名前、英語名、原子量、分類）
        const elementsData = [
            {id: 1, symbol: "H", name: "水素", enName: "Hydrogen", mass: 1.008, category: "nonmetal", electronConfig: "1s¹", facts: "水素は宇宙で最も豊富な元素であり、全ての恒星のエネルギー源として機能しています。また、水素は水の主要成分でもあります。"},
            {id: 2, symbol: "He", name: "ヘリウム", enName: "Helium", mass: 4.0026, category: "noble-gas", electronConfig: "1s²", facts: "ヘリウムは宇宙で2番目に豊富な元素で、太陽のエネルギー源となる核融合反応の生成物です。非常に軽く、非反応性で、気球や深海ダイビングに使用されます。"},
            {id: 3, symbol: "Li", name: "リチウム", enName: "Lithium", mass: 6.94, category: "alkali-metal", electronConfig: "1s² 2s¹", facts: "リチウムは最も軽い金属で、高エネルギー密度のためリチウムイオン電池に広く使用されています。また、双極性障害の治療薬としても使用されています。"},
            {id: 4, symbol: "Be", name: "ベリリウム", enName: "Beryllium", mass: 9.0122, category: "alkaline-earth-metal", electronConfig: "1s² 2s²", facts: "ベリリウムは軽量で強度が高く、航空宇宙産業や核反応炉で使用されます。ただし、その化合物は毒性があるため取り扱いに注意が必要です。"},
            {id: 5, symbol: "B", name: "ホウ素", enName: "Boron", mass: 10.81, category: "metalloid", electronConfig: "1s² 2s² 2p¹", facts: "ホウ素は半導体として振る舞い、ガラス製造や洗剤、農業用肥料に使用されます。ホウ素化合物は高い熱安定性を持ちます。"},
            {id: 6, symbol: "C", name: "炭素", enName: "Carbon", mass: 12.011, category: "nonmetal", electronConfig: "1s² 2s² 2p²", facts: "炭素は生命の基礎となる元素で、ダイヤモンドやグラファイトなど異なる同素体を持ちます。有機化学の中心的元素であり、無数の化合物を形成します。"},
            {id: 7, symbol: "N", name: "窒素", enName: "Nitrogen", mass: 14.007, category: "nonmetal", electronConfig: "1s² 2s² 2p³", facts: "窒素は大気の約78%を占め、アミノ酸やタンパク質など生命分子の重要な構成要素です。液体窒素は極低温冷媒として広く使用されています。"},
            {id: 8, symbol: "O", name: "酸素", enName: "Oxygen", mass: 15.999, category: "nonmetal", electronConfig: "1s² 2s² 2p⁴", facts: "酸素は地球の大気の約21%を占め、ほぼすべての生物の呼吸に不可欠です。また、燃焼を支える元素としても重要です。"},
            {id: 9, symbol: "F", name: "フッ素", enName: "Fluorine", mass: 18.998, category: "halogen", electronConfig: "1s² 2s² 2p⁵", facts: "フッ素は最も反応性の高い非金属で、ほぼすべての元素と反応します。フッ化物は歯の健康維持に重要で、多くの歯磨き粉に含まれています。"},
            {id: 10, symbol: "Ne", name: "ネオン", enName: "Neon", mass: 20.180, category: "noble-gas", electronConfig: "1s² 2s² 2p⁶", facts: "ネオンは完全に不活性で、明るい赤橙色の放電光で知られています。看板や照明に広く使用されています。"},
            {id: 11, symbol: "Na", name: "ナトリウム", enName: "Sodium", mass: 22.990, category: "alkali-metal", electronConfig: "1s² 2s² 2p⁶ 3s¹", facts: "ナトリウムは高い反応性を持つ柔らかい金属で、塩化ナトリウム（食塩）の形で広く存在します。生体内では神経信号の伝達に重要な役割を果たしています。"},
            {id: 12, symbol: "Mg", name: "マグネシウム", enName: "Magnesium", mass: 24.305, category: "alkaline-earth-metal", electronConfig: "1s² 2s² 2p⁶ 3s²", facts: "マグネシウムは地殻で8番目に豊富な元素で、植物の葉緑素の中心元素です。軽量で強度があり、合金として広く使用されています。"},
            {id: 13, symbol: "Al", name: "アルミニウム", enName: "Aluminum", mass: 26.982, category: "post-transition-metal", electronConfig: "1s² 2s² 2p⁶ 3s² 3p¹", facts: "アルミニウムは地殻で最も豊富な金属で、軽量、耐食性があり、優れた熱・電気伝導性を持つため、包装、建設、輸送など多くの用途に使用されています。"},
            {id: 14, symbol: "Si", name: "ケイ素", enName: "Silicon", mass: 28.085, category: "metalloid", electronConfig: "1s² 2s² 2p⁶ 3s² 3p²", facts: "ケイ素は地殻で2番目に豊富な元素で、ガラスや陶器の主成分です。半導体としての性質から、電子機器やソーラーパネルに不可欠です。"},
            {id: 15, symbol: "P", name: "リン", enName: "Phosphorus", mass: 30.974, category: "nonmetal", electronConfig: "1s² 2s² 2p⁶ 3s² 3p³", facts: "リンはDNAやRNAなど生命分子の重要な構成要素です。また、肥料、洗剤、そしてマッチの生産に使用されています。"},
            {id: 16, symbol: "S", name: "硫黄", enName: "Sulfur", mass: 32.06, category: "nonmetal", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁴", facts: "硫黄は古代から知られている元素で、火山地帯に多く存在します。タンパク質の構造形成や多くの工業プロセスに重要です。"},
            {id: 17, symbol: "Cl", name: "塩素", enName: "Chlorine", mass: 35.45, category: "halogen", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁵", facts: "塩素は強力な殺菌作用があり、水処理や漂白剤に広く使用されています。塩化ナトリウム（食塩）の形でも一般的です。"},
            {id: 18, symbol: "Ar", name: "アルゴン", enName: "Argon", mass: 39.948, category: "noble-gas", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶", facts: "アルゴンは大気中で3番目に豊富なガスで、電球や溶接作業の不活性雰囲気として使用されます。完全に化学的に不活性です。"},
            {id: 19, symbol: "K", name: "カリウム", enName: "Potassium", mass: 39.098, category: "alkali-metal", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶ 4s¹", facts: "カリウムは生物学的に重要な元素で、細胞機能や神経伝達に不可欠です。また、農業における主要な肥料成分です。"},
            {id: 20, symbol: "Ca", name: "カルシウム", enName: "Calcium", mass: 40.078, category: "alkaline-earth-metal", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶ 4s²", facts: "カルシウムは人体で最も豊富な金属で、骨と歯の主要成分です。また、セメントや石灰石の主成分でもあります。"},
            // 21-30
            {id: 21, symbol: "Sc", name: "スカンジウム", enName: "Scandium", mass: 44.956, category: "transition-metal", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶ 3d¹ 4s²", facts: "スカンジウムは軽量で高強度の合金に使用され、航空宇宙産業で重要です。希少ですが、特定の鉱物に存在します。"},
            {id: 22, symbol: "Ti", name: "チタン", enName: "Titanium", mass: 47.867, category: "transition-metal", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶ 3d² 4s²", facts: "チタンは強度重量比が非常に高く、耐食性に優れているため、航空機部品や医療用インプラントに広く使用されています。"},
            {id: 23, symbol: "V", name: "バナジウム", enName: "Vanadium", mass: 50.942, category: "transition-metal", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶ 3d³ 4s²", facts: "バナジウムは高強度鋼の生産に使用され、一部の生物では必須微量元素です。また、充電式バッテリーにも使用されます。"},
            {id: 24, symbol: "Cr", name: "クロム", enName: "Chromium", mass: 51.996, category: "transition-metal", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶ 3d⁵ 4s¹", facts: "クロムは硬度が高く、光沢がある金属で、ステンレス鋼の主要成分です。また、メッキや顔料としても広く使用されています。"},
            {id: 25, symbol: "Mn", name: "マンガン", enName: "Manganese", mass: 54.938, category: "transition-metal", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶ 3d⁵ 4s²", facts: "マンガンは鉄鋼製造に重要で、生物学的にも光合成や酵素活性に関与しています。多くの酸化状態を持つことで知られています。"},
            {id: 26, symbol: "Fe", name: "鉄", enName: "Iron", mass: 55.845, category: "transition-metal", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶ 3d⁶ 4s²", facts: "鉄は地球の核の主成分であり、生物学的にもヘモグロビンの中心元素として酸素輸送に不可欠です。金属の中で最も一般的に使用されています。"},
            {id: 27, symbol: "Co", name: "コバルト", enName: "Cobalt", mass: 58.933, category: "transition-metal", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶ 3d⁷ 4s²", facts: "コバルトはビタミンB12の中心元素で、強磁性合金やリチウムイオン電池の製造に重要です。青色顔料としても歴史的に使用されています。"},
            {id: 28, symbol: "Ni", name: "ニッケル", enName: "Nickel", mass: 58.693, category: "transition-metal", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶ 3d⁸ 4s²", facts: "ニッケルは耐食性が高く、多くの合金に使用されます。地球の核にも存在し、一部の隕石には高濃度で含まれています。"},
            {id: 29, symbol: "Cu", name: "銅", enName: "Copper", mass: 63.546, category: "transition-metal", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶ 3d¹⁰ 4s¹", facts: "銅は優れた熱・電気伝導性を持つ金属で、電線や配管に広く使用されています。また、多くの生物の酵素系にも不可欠です。"},
            {id: 30, symbol: "Zn", name: "亜鉛", enName: "Zinc", mass: 65.38, category: "transition-metal", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶ 3d¹⁰ 4s²", facts: "亜鉛は多くの酵素の機能に必要な微量元素で、免疫系の健康維持に重要です。金属としては腐食防止のためのメッキに使用されます。"},
            // 31-36
            {id: 31, symbol: "Ga", name: "ガリウム", enName: "Gallium", mass: 69.723, category: "post-transition-metal", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶ 3d¹⁰ 4s² 4p¹", facts: "ガリウムは室温近くで溶ける珍しい金属で、半導体産業で広く使用されています。高温計や特殊な合金にも利用されています。"},
            {id: 32, symbol: "Ge", name: "ゲルマニウム", enName: "Germanium", mass: 72.630, category: "metalloid", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶ 3d¹⁰ 4s² 4p²", facts: "ゲルマニウムは半導体として重要で、初期のトランジスタに使用されました。光ファイバーやinfrared光学機器にも使用されています。"},
            {id: 33, symbol: "As", name: "ヒ素", enName: "Arsenic", mass: 74.922, category: "metalloid", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶ 3d¹⁰ 4s² 4p³", facts: "ヒ素は毒性で知られていますが、一部の半導体や木材防腐剤に使用されています。特定の細菌は代謝にヒ素を利用することができます。"},
            {id: 34, symbol: "Se", name: "セレン", enName: "Selenium", mass: 78.971, category: "nonmetal", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶ 3d¹⁰ 4s² 4p⁴", facts: "セレンは光電池や太陽電池に使用され、生物学的には抗酸化酵素の構成要素として重要です。欠乏症は特定の地域で健康問題となっています。"},
            {id: 35, symbol: "Br", name: "臭素", enName: "Bromine", mass: 79.904, category: "halogen", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶ 3d¹⁰ 4s² 4p⁵", facts: "臭素は室温で液体の唯一のハロゲンで、かつては写真フィルムの製造に重要でした。現在は難燃剤や農薬に使用されています。"},
            {id: 36, symbol: "Kr", name: "クリプトン", enName: "Krypton", mass: 83.798, category: "noble-gas", electronConfig: "1s² 2s² 2p⁶ 3s² 3p⁶ 3d¹⁰ 4s² 4p⁶", facts: "クリプトンは稀ガスで、高強度の写真用フラッシュや特殊な照明に使用されます。かつては国際メートル原器の定義にも使用されました。"},
            // 37-118はスペースの関係で省略...例示として一部を含めています
            // ランタノイド(La-Lu)とアクチノイド(Ac-Lr)は別の行に表示します
        ];
        
        // 周期表のレイアウト定義
        const periodicTableLayout = [
            // 1列目
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2],
            [3, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 6, 7, 8, 9, 10],
            [11, 12, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 13, 14, 15, 16, 17, 18],
            [19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36]
            // 残りの行は省略（スペースの関係で）
        ];
        
        // ランタノイドとアクチノイド
        const lanthanideActinideLayout = [
            // ランタノイド (57-71)
            [null, null, null, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71],
            // アクチノイド (89-103)
            [null, null, null, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103]
        ];
        
        // 周期表の生成
        const periodicTable = document.getElementById("periodic-table");
        periodicTableLayout.forEach(row => {
            row.forEach(elementId => {
                const cell = document.createElement("div");
                
                if (elementId === 0) {
                    // 空のセル
                    cell.className = "empty-cell";
                    periodicTable.appendChild(cell);
                    return;
                }
                
                const element = elementsData.find(e => e.id === elementId);
                
                if (element) {
                    cell.className = `element ${element.category}`;
                    cell.id = `element-${element.id}`;
                    cell.innerHTML = `
                        <div class="element-atomic-number">${element.id}</div>
                        <div class="element-symbol">${element.symbol}</div>
                        <div class="element-name-small">${element.name}</div>
                        <div class="element-mass">${element.mass}</div>
                    `;
                    
                    // 元素クリック時のイベント
                    cell.addEventListener("click", () => selectElement(element));
                    
                    // ツールチップ用のホバーイベント
                    cell.addEventListener("mouseover", (e) => {
                        const tooltip = document.getElementById("tooltip");
                        tooltip.textContent = `${element.id}. ${element.name} (${element.enName})`;
                        tooltip.style.display = "block";
                        tooltip.style.left = `${e.pageX + 10}px`;
                        tooltip.style.top = `${e.pageY + 10}px`;
                    });
                    
                    cell.addEventListener("mousemove", (e) => {
                        const tooltip = document.getElementById("tooltip");
                        tooltip.style.left = `${e.pageX + 10}px`;
                        tooltip.style.top = `${e.pageY + 10}px`;
                    });
                    
                    cell.addEventListener("mouseout", () => {
                        document.getElementById("tooltip").style.display = "none";
                    });
                }
                
                periodicTable.appendChild(cell);
            });
        });
        
        // ランタノイドとアクチノイドの生成
        const lanthanideActinideContainer = document.getElementById("lanthanide-actinide-container");
        lanthanideActinideLayout.forEach((row, rowIndex) => {
            row.forEach((elementId, colIndex) => {
                if (colIndex < 3) {
                    const spacer = document.createElement("div");
                    spacer.className = "empty-cell";
                    lanthanideActinideContainer.appendChild(spacer);
                    return;
                }
                
                if (!elementId) {
                    const emptyCell = document.createElement("div");
                    emptyCell.className = "empty-cell";
                    lanthanideActinideContainer.appendChild(emptyCell);
                    return;
                }
                
                // ダミーデータ（本来は完全なデータセットを用意）
                const elementData = {
                    id: elementId,
                    symbol: rowIndex === 0 ? "La+" : "Ac+", // 簡略化
                    name: rowIndex === 0 ? "ランタノイド" : "アクチノイド",
                    enName: rowIndex === 0 ? "Lanthanide" : "Actinide",
                    mass: 0,
                    category: rowIndex === 0 ? "lanthanide" : "actinide",
                    electronConfig: ""
                };
                
                const cell = document.createElement("div");
                cell.className = `element ${elementData.category}`;
                cell.innerHTML = `
                    <div class="element-atomic-number">${elementData.id}</div>
                    <div class="element-symbol">${elementData.symbol}</div>
                    <div class="element-name-small">${elementData.name}</div>
                `;
                
                lanthanideActinideContainer.appendChild(cell);
            });
        });
        
        // 元素選択処理
        function selectElement(element) {
            // UI更新
            const symbolBox = document.getElementById("element-symbol-box");
            symbolBox.textContent = element.symbol;
            symbolBox.className = `element-symbol ${element.category}`;
            
            document.getElementById("element-name").textContent = `${element.name}（${element.enName}）`;
            document.getElementById("element-properties").textContent = `原子番号: ${element.id} | 原子量: ${element.mass} | 電子数: ${element.id} | 陽子数: ${element.id} | 中性子数: ${Math.round(element.mass) - element.id}`;
            
            document.getElementById("electron-config-notation").textContent = element.electronConfig;
            
            // 簡易的な電子殻表示（完全ではありません）
            let shellsHTML = '';
            if (element.id <= 2) {
                shellsHTML = `<div class="shell">K殻: ${element.id}</div>`;
            } else if (element.id <= 10) {
                shellsHTML = `<div class="shell">K殻: 2</div><div class="shell">L殻: ${element.id - 2}</div>`;
            } else if (element.id <= 18) {
                shellsHTML = `<div class="shell">K殻: 2</div><div class="shell">L殻: 8</div><div class="shell">M殻: ${element.id - 10}</div>`;
            } else if (element.id <= 36) {
                const remaining = element.id - 28;
                shellsHTML = `<div class="shell">K殻: 2</div><div class="shell">L殻: 8</div><div class="shell">M殻: 18</div><div class="shell">N殻: ${remaining}</div>`;
            } else {
                shellsHTML = `<div class="shell">K殻: 2</div><div class="shell">L殻: 8</div><div class="shell">M殻: 18</div><div class="shell">N殻: 8+</div>`;
            }
            
            document.getElementById("electron-shells").innerHTML = shellsHTML;
            document.getElementById("element-facts").textContent = element.facts || "情報がありません。";
            
            // 現在選択されている元素のマーキング
            document.querySelectorAll(".element").forEach(el => el.classList.remove("active"));
            document.getElementById(`element-${element.id}`)?.classList.add("active");
            
            // アニメーションリセット
            resetCanvas();
            
            // 詳細モーダルの情報更新
            updateDetailModal(element);
        }
        
        // 詳細モーダルの更新
        function updateDetailModal(element) {
            document.getElementById("modal-title").textContent = `${element.name} (${element.symbol})`;
            
            // 電子配置の説明
            let electronExplanation = "";
            if (element.id === 1) {
                electronExplanation = "水素は最も単純な原子構造を持ち、1つの電子が1s軌道に存在します。これはK殻とも呼ばれる最初の電子殻に相当します。";
            } else if (element.id === 2) {
                electronExplanation = "ヘリウムは2つの電子を持ち、両方が1s軌道（K殻）に存在します。このK殻が完全に満たされた状態が、ヘリウムの高い安定性と化学的不活性の理由です。";
            } else if (element.id <= 10) {
                electronExplanation = `${element.name}は${element.id}個の電子を持ち、最初の2個はK殻（1s軌道）に、残りは第2殻（L殻）の2s及び2p軌道に分布します。`;
            } else {
                electronExplanation = `${element.name}は複雑な電子配置を持ち、内側の殻から順次電子で満たされ、特徴的な化学的性質を示します。`;
            }
            document.getElementById("electron-explanation").textContent = electronExplanation;
            
            // ボーアモデルと量子力学モデルの説明
            const bohrExplanation = document.getElementById("bohr-explanation");
            const quantumExplanation = document.getElementById("quantum-explanation");
            
            if (element.id <= 10) {
                bohrExplanation.innerHTML = `<p>ボーアモデルでは、${element.name}の${element.id}個の電子は特定の軌道（殻）に配置されます。これらの電子は原子核の周りを規則的に周回し、各軌道にはエネルギーレベルがあります。</p>
                <p>${element.name}では、最初の電子はK殻に配置され、それ以降の電子は順次外側の殻に配置されます。このモデルは原子スペクトルの説明に有用ですが、電子の波動性は考慮していません。</p>`;
                
                quantumExplanation.innerHTML = `<p>量子力学モデルでは、${element.name}の電子は確率雲として表現され、特定の軌道（オービタル）に存在する確率分布を持ちます。</p>
                <p>これらのオービタルはパウリの排他原理と電子間反発を考慮して満たされていきます。${element.name}の電子配置「${element.electronConfig}」は、この量子力学的な充填順序を表しています。</p>`;
            } else {
                bohrExplanation.innerHTML = `<p>ボーアモデルでは、${element.name}のような複雑な原子でも、電子は特定の軌道（殻）に配置されると考えられます。</p>
                <p>しかし、多くの電子を持つ原子では、電子間相互作用など、このモデルでは説明できない複雑な現象が発生します。</p>`;
                
                quantumExplanation.innerHTML = `<p>量子力学モデルは、${element.name}のような多電子原子の複雑な振る舞いをよく説明できます。電子はs, p, d, f軌道に分布し、これらは特徴的な形状と確率分布を持ちます。</p>
                <p>${element.name}の電子配置は、フントの規則とパウリの排他原理に従って、エネルギーの低い軌道から順に埋められていきます。</p>`;
            }
            
            // サブシェル情報
            const subshellInfo = document.getElementById("subshell-info-container");
            if (element.id <= 18) {
                subshellInfo.style.display = "block";
                const subshellContent = document.querySelector(".subshell-info");
                subshellContent.innerHTML = `<p>${element.name}原子の電子は、量子力学的に定義されたサブシェルに配置されます。</p>
                <p>- s軌道：球形の確率分布を持ち、電子2個まで収容可能</p>
                <p>- p軌道：ダンベル型の確率分布で、x, y, z方向に3つ存在し、合計6個の電子を収容可能</p>`;
                
                if (element.id > 10) {
                    subshellContent.innerHTML += `<p>- d軌道：より複雑な形状で5つ存在し、合計10個の電子を収容可能</p>`;
                }
                
                if (element.id > 18) {
                    subshellContent.innerHTML += `<p>- f軌道：さらに複雑な形状で7つ存在し、合計14個の電子を収容可能</p>`;
                }
            } else {
                subshellInfo.style.display = "block";
            }
            
            // 重要特性と用途
            let importanceText = "";
            switch (element.id) {
                case 1:
                    importanceText = "水素は宇宙で最も豊富な元素であり、全ての恒星のエネルギー源です。地球上では主に水（H₂O）の形で存在し、生命活動に不可欠です。工業的には化学合成、燃料、還元剤として幅広く使用されています。また、将来のクリーンエネルギー源としても期待されています。";
                    break;
                case 2:
                    importanceText = "ヘリウムは宇宙で2番目に豊富な元素で、その軽さと不活性な性質から、気球や飛行船の浮力ガスとして使用されます。また、極低温冷却剤として科学研究や医療用MRIスキャナーに不可欠です。希少性が増しており、保全が重要な資源となっています。";
                    break;
                case 6:
                    importanceText = "炭素は全ての既知生命体の基盤となる元素で、有機化学の中心です。ダイヤモンドからグラファイト、フラーレン、グラフェンまで多様な同素体を持ち、それぞれ異なる特性を示します。産業的には鋼鉄生産から電子機器、医療技術まで幅広く応用されています。";
                    break;
                case 8:
                    importanceText = "酸素は地球大気の約21%を占め、ほぼすべての生物の呼吸に不可欠です。また、水の構成要素としても生命維持に重要です。工業的には金属精錬、化学合成、医療用途など幅広く使用されています。地球環境と生命の歴史において中心的な役割を果たしてきました。";
                    break;
                default:
                    importanceText = `${element.name}は科学と産業の両方で重要な役割を果たしています。その特有の性質により、様々な分野で応用されています。`;
            }
            document.getElementById("element-importance").textContent = importanceText;
            
            // 発見の歴史
            let historyText = "";
            switch (element.id) {
                case 1:
                    historyText = "水素は1766年にヘンリー・キャヴェンディッシュによって単体元素として識別されました。彼は金属と酸の反応で生じるガスを研究し、このガスが燃焼すると水が生成されることを発見しました。この性質から「水を生み出すもの」という意味で「ヒドロゲン（水素）」と名付けられました。";
                    break;
                case 2:
                    historyText = "ヘリウムは1868年に、太陽スペクトル中の未知の黄色い線として初めて発見されました。この発見はノーマン・ロッキャーとピエール・ジャンセンによるもので、ギリシャ語の「太陽」を意味する「helios」にちなんで名付けられました。地球上での単離は1895年にラムゼー卿によって初めて成功しました。";
                    break;
                case 6:
                    historyText = "炭素は古代から木炭や黒鉛、ダイヤモンドの形で知られていましたが、それらが同じ元素であることが認識されたのは18世紀になってからです。1772年にラボアジエが炭素が基本元素であることを証明し、ラテン語の「carbo（石炭）」に由来する名前が付けられました。";
                    break;
                case 8:
                    historyText = "酸素は1774年にジョセフ・プリーストリーによって発見され、独立してカール・ヴィルヘルム・シェーレも1773年に分離に成功していました。アントワーヌ・ラボアジエがこの元素の性質を詳細に研究し、「酸を生成するもの」という意味でoxygèneと名付けました。";
                    break;
                default:
                    historyText = `${element.name}の発見と研究の歴史は、化学の発展と密接に関連しています。科学の進歩とともに、その性質と用途の理解も深まってきました。`;
            }
            document.getElementById("element-history").textContent = historyText;
        }
        
        // モーダル表示トグル
        document.getElementById("element-symbol-box").addEventListener("click", () => {
            document.getElementById("detail-modal").style.display = "flex";
        });
        
        document.getElementById("modal-close").addEventListener("click", () => {
            document.getElementById("detail-modal").style.display = "none";
        });
        
        // モデル切り替え
        document.querySelectorAll(".model-toggle").forEach(button => {
            button.addEventListener("click", function() {
                document.querySelectorAll(".model-toggle").forEach(btn => btn.classList.remove("active"));
                this.classList.add("active");
                
                const model = this.getAttribute("data-model");
                if (model === "bohr") {
                    document.getElementById("bohr-explanation").style.display = "block";
                    document.getElementById("quantum-explanation").style.display = "none";
                } else {
                    document.getElementById("bohr-explanation").style.display = "none";
                    document.getElementById("quantum-explanation").style.display = "block";
                }
            });
        });
        
        // p5.js関連のコード
        let atomCanvas;
        let electrons = [];
        let selectedElement = elementsData[0]; // デフォルトで水素を選択
        let animationSpeed = 1;
        let paused = false;
        let viewMode = "bohr"; // ボーアモデルをデフォルトに
        let showLabels = true;
        
        function setup() {
            const canvasContainer = document.getElementById("canvas-container");
            atomCanvas = createCanvas(canvasContainer.offsetWidth, canvasContainer.offsetHeight);
            atomCanvas.parent("canvas-container");
            
            initializeElectrons();
            
            // ビューコントロール
            document.getElementById("bohr-model").addEventListener("click", function() {
                viewMode = "bohr";
                updateViewButtons();
                resetCanvas();
            });
            
            document.getElementById("orbital-model").addEventListener("click", function() {
                viewMode = "orbital";
                updateViewButtons();
                resetCanvas();
            });
            
            document.getElementById("electron-cloud").addEventListener("click", function() {
                viewMode = "cloud";
                updateViewButtons();
                resetCanvas();
            });
            
            document.getElementById("show-labels").addEventListener("click", function() {
                showLabels = !showLabels;
                this.classList.toggle("active");
            });
            
            // アニメーションコントロール
            document.getElementById("slower-btn").addEventListener("click", function() {
                animationSpeed = Math.max(0.25, animationSpeed / 1.5);
            });
            
            document.getElementById("faster-btn").addEventListener("click", function() {
                animationSpeed = Math.min(3, animationSpeed * 1.5);
            });
            
            document.getElementById("pause-btn").addEventListener("click", function() {
                paused = !paused;
                if (paused) {
                    this.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                        再生
                    `;
                } else {
                    this.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                        </svg>
                        一時停止
                    `;
                }
            });
            
            // 初期要素選択
            selectElement(selectedElement);
        }
        
        function draw() {
            background(240);
            
            // 中心に原子核を描画
            drawNucleus();
            
            if (viewMode === "bohr") {
                drawBohrModel();
            } else if (viewMode === "orbital") {
                drawOrbitalModel();
            } else if (viewMode === "cloud") {
                drawElectronCloud();
            }
            
            // 電子の更新と描画
            if (!paused) {
                updateElectrons();
            }
            drawElectrons();
            
            // ラベルの描画
            if (showLabels) {
                drawLabels();
            }
        }
        
        function initializeElectrons() {
            electrons = [];
            const electronCount = selectedElement.id;
            
            // シェルごとの電子数の定義
            let shells = [];
            
            if (electronCount <= 2) {
                shells = [electronCount];
            } else if (electronCount <= 10) {
                shells = [2, electronCount - 2];
            } else if (electronCount <= 18) {
                shells = [2, 8, electronCount - 10];
            } else if (electronCount <= 36) {
                const remaining = electronCount - 28;
                shells = [2, 8, 18, remaining];
            } else if (electronCount <= 54) {
                const remaining = electronCount - 46;
                shells = [2, 8, 18, 18, remaining];
            } else {
                // 近似値として
                shells = [2, 8, 18, 32, 18, electronCount - 78];
            }
            
            // 各シェルに電子を配置
            let electronIndex = 0;
            shells.forEach((shellCount, shellIndex) => {
                const shellRadius = 30 + shellIndex * 40;
                const angleStep = TWO_PI / shellCount;
                
                for (let i = 0; i < shellCount; i++) {
                    const angle = i * angleStep;
                    const electron = {
                        x: width / 2 + shellRadius * cos(angle),
                        y: height / 2 + shellRadius * sin(angle),
                        radius: shellRadius,
                        angle: angle,
                        speed: 0.02 / (shellIndex + 1), // シェルごとに速度を調整
                        shell: shellIndex + 1,
                        subshell: getSubshell(electronIndex + 1),
                        direction: random() > 0.5 ? 1 : -1 // 方向をランダムに
                    };
                    electrons.push(electron);
                    electronIndex++;
                }
            });
        }
        
        function getSubshell(electronIndex) {
            // 簡略化したサブシェル割り当て
            if (electronIndex <= 2) return "1s";
            if (electronIndex <= 4) return "2s";
            if (electronIndex <= 10) return "2p";
            if (electronIndex <= 12) return "3s";
            if (electronIndex <= 18) return "3p";
            if (electronIndex <= 20) return "4s";
            if (electronIndex <= 30) return "3d";
            return "4p"; // 簡略化のため
        }
        
        function updateElectrons() {
            electrons.forEach(electron => {
                // ボーアモデルでの更新
                if (viewMode === "bohr") {
                    electron.angle += electron.speed * electron.direction * animationSpeed;
                    electron.x = width / 2 + electron.radius * cos(electron.angle);
                    electron.y = height / 2 + electron.radius * sin(electron.angle);
                }
                // 軌道モデルでの更新
                else if (viewMode === "orbital") {
                    // 軌道モデルではより複雑な動きを模倣
                    const noise1 = noise(frameCount * 0.01 + electron.shell * 10) * 0.2;
                    const noise2 = noise(frameCount * 0.01 + electron.shell * 20) * 0.2;
                    
                    electron.angle += (electron.speed + noise1) * electron.direction * animationSpeed;
                    
                    // サブシェルによって軌道の形を変える
                    if (electron.subshell.includes('s')) {
                        // s軌道は球形
                        electron.x = width / 2 + electron.radius * cos(electron.angle);
                        electron.y = height / 2 + electron.radius * sin(electron.angle);
                    } else if (electron.subshell.includes('p')) {
                        // p軌道はダンベル型（簡略化）
                        const mod = frameCount % 300;
                        const factor = sin(mod / 300 * TWO_PI);
                        electron.x = width / 2 + electron.radius * cos(electron.angle) * (1 + factor * 0.3);
                        electron.y = height / 2 + electron.radius * sin(electron.angle) * (1 - factor * 0.3);
                    } else {
                        // d, f軌道はより複雑（簡略化）
                        const wobble = sin(frameCount * 0.05 + electron.shell) * 10;
                        electron.x = width / 2 + electron.radius * cos(electron.angle) + wobble;
                        electron.y = height / 2 + electron.radius * sin(electron.angle) + wobble;
                    }
                }
                // 電子雲モデルでの更新
                else if (viewMode === "cloud") {
                    // ランダムな位置変動で確率雲を表現
                    const randomRadius = electron.radius * (0.8 + random() * 0.4);
                    const randomAngle = random() * TWO_PI;
                    electron.x = width / 2 + randomRadius * cos(randomAngle);
                    electron.y = height / 2 + randomRadius * sin(randomAngle);
                    
                    // シェルごとの確率密度表現
                    if (random() > 0.8) {
                        electron.x = width / 2 + (electron.radius * 0.5) * cos(randomAngle);
                        electron.y = height / 2 + (electron.radius * 0.5) * sin(randomAngle);
                    }
                }
            });
        }
        
        function drawNucleus() {
            push();
            translate(width / 2, height / 2);
            
            // 核子の数に応じてサイズを調整
            const nucleonCount = selectedElement.id + Math.round(selectedElement.mass) - selectedElement.id;
            const nucleusSize = map(nucleonCount, 1, 100, 20, 60);
            
            // 核子（陽子と中性子）を描画
            for (let i = 0; i < nucleonCount; i++) {
                const angle = random(TWO_PI);
                const dist = random(nucleusSize / 2);
                const x = dist * cos(angle);
                const y = dist * sin(angle);
                
                if (i < selectedElement.id) {
                    // 陽子（赤）
                    fill(255, 100, 100);
                } else {
                    // 中性子（青）
                    fill(100, 100, 255);
                }
                
                noStroke();
                ellipse(x, y, 8, 8);
            }
            
            // 核全体の輪郭
            noFill();
            stroke(30);
            strokeWeight(1);
            ellipse(0, 0, nucleusSize, nucleusSize);
            
            pop();
        }
        
        function drawBohrModel() {
            push();
            translate(width / 2, height / 2);
            
            // 電子殻を描画
            noFill();
            stroke(150);
            strokeWeight(1);
            
            // シェルごとの電子数をカウント
            const shellCounts = {};
            electrons.forEach(e => {
                if (!shellCounts[e.shell]) shellCounts[e.shell] = 0;
                shellCounts[e.shell]++;
            });
            
            // 各シェルを描画
            Object.keys(shellCounts).forEach(shell => {
                const shellRadius = 30 + (parseInt(shell) - 1) * 40;
                ellipse(0, 0, shellRadius * 2, shellRadius * 2);
            });
            
            pop();
        }
        
        function drawOrbitalModel() {
            push();
            translate(width / 2, height / 2);
            
            // 電子軌道を描画
            noFill();
            
            // サブシェルごとに軌道を描画
            const subshells = {};
            electrons.forEach(e => {
                if (!subshells[e.subshell]) subshells[e.subshell] = e.shell;
            });
            
            for (const [subshell, shell] of Object.entries(subshells)) {
                const shellRadius = 30 + (shell - 1) * 40;
                
                if (subshell.includes('s')) {
                    // s軌道（球形）
                    stroke(100, 100, 255, 100);
                    strokeWeight(2);
                    ellipse(0, 0, shellRadius * 2, shellRadius * 2);
                } else if (subshell.includes('p')) {
                    // p軌道（ダンベル型 - 簡略化）
                    stroke(100, 255, 100, 100);
                    strokeWeight(2);
                    
                    // x, y, z方向の軌道を表現
                    drawingContext.setLineDash([5, 5]);
                    ellipse(0, 0, shellRadius * 2.2, shellRadius * 1.8);
                    ellipse(0, 0, shellRadius * 1.8, shellRadius * 2.2);
                    drawingContext.setLineDash([]);
                } else if (subshell.includes('d')) {
                    // d軌道（複雑な形 - 簡略化）
                    stroke(255, 100, 100, 80);
                    strokeWeight(1);
                    
                    for (let i = 0; i < 5; i++) {
                        const angle = i * TWO_PI / 5;
                        const x1 = shellRadius * 0.7 * cos(angle);
                        const y1 = shellRadius * 0.7 * sin(angle);
                        const x2 = shellRadius * 1.3 * cos(angle);
                        const y2 = shellRadius * 1.3 * sin(angle);
                        
                        line(x1, y1, x2, y2);
                        ellipse(x2, y2, 20, 20);
                    }
                }
            }
            
            pop();
        }
        
        function drawElectronCloud() {
            push();
            translate(width / 2, height / 2);
            
            // 電子雲を描画（確率密度の表現）
            for (let i = 0; i < 200; i++) {
                const shell = floor(random(1, electrons.length > 0 ? Math.max(...electrons.map(e => e.shell)) + 1 : 2));
                const radius = 30 + (shell - 1) * 40;
                const distance = randomGaussian(0, radius / 2);
                const angle = random(TWO_PI);
                const x = distance * cos(angle);
                const y = distance * sin(angle);
                
                // シェルに基づいて色を変える
                if (shell === 1) fill(100, 100, 255, 10);
                else if (shell === 2) fill(100, 255, 100, 8);
                else if (shell === 3) fill(255, 100, 100, 6);
                else fill(255, 255, 100, 4);
                
                noStroke();
                ellipse(x, y, 5, 5);
            }
            
            pop();
        }
        
        function drawElectrons() {
            electrons.forEach(electron => {
                push();
                // 電子の色（シェルに基づく）
                if (electron.shell === 1) fill(100, 100, 255);
                else if (electron.shell === 2) fill(100, 255, 100);
                else if (electron.shell === 3) fill(255, 100, 100);
                else if (electron.shell === 4) fill(255, 255, 100);
                else fill(255, 100, 255);
                
                noStroke();
                ellipse(electron.x, electron.y, 8, 8);
                pop();
            });
        }
        
        function drawLabels() {
            push();
            textAlign(CENTER, CENTER);
            textSize(14);
            fill(50);
            
            // 核のラベル
            text(`${selectedElement.symbol}`, width / 2, height / 2);
            
            // シェルのラベル
            const shellCounts = {};
            electrons.forEach(e => {
                if (!shellCounts[e.shell]) shellCounts[e.shell] = 0;
                shellCounts[e.shell]++;
            });
            
            Object.keys(shellCounts).sort().forEach(shell => {
                const shellRadius = 30 + (parseInt(shell) - 1) * 40;
                const labelX = width / 2 + shellRadius + 10;
                const labelY = height / 2;
                
                const shellName = ['K', 'L', 'M', 'N', 'O', 'P', 'Q'][parseInt(shell) - 1] || shell;
                fill(50);
                text(`${shellName}殻 (${shellCounts[shell]}e)`, labelX, labelY);
            });
            
            pop();
        }
        
        function resetCanvas() {
            initializeElectrons();
        }
        
        function updateViewButtons() {
            document.querySelectorAll(".view-toggle").forEach(btn => btn.classList.remove("active"));
            document.getElementById(viewMode + "-model").classList.add("active");
            if (viewMode === "electron-cloud") {
                document.getElementById("electron-cloud").classList.add("active");
            }
        }
        
        window.onresize = function() {
            const canvasContainer = document.getElementById("canvas-container");
            resizeCanvas(canvasContainer.offsetWidth, canvasContainer.offsetHeight);
        };
    </script>
</body>
</html>